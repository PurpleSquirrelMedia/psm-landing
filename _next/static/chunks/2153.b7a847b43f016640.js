"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2153],{12153:function(t,e,a){a.r(e),a.d(e,{EvmTBTCBridge:function(){return i}});var n=a(73109),r=a(54879);class i{network;chain;provider;contracts;chainId;core;gatewayAddress;gateway;tbtcTokenAddr;constructor(t,e,a,i){if(this.network=t,this.chain=e,this.provider=a,this.contracts=i,"Mainnet"!==this.network)throw Error("TBTC is only supported on Mainnet");if(!this.contracts.tbtc)throw Error("TBTC contract address is required");let s=n.T.getNativeTbtcToken(this.chain);if(!s)throw Error("Native tbtc token not found");this.chainId=n.l.get(t,e),this.core=new r.EvmWormholeCore(t,e,a,i),this.gatewayAddress=this.contracts.tbtc,this.gateway=new n.E(this.gatewayAddress,["function sendTbtc(uint256 amount, uint16 recipientChain, bytes32 recipient, uint256 arbiterFee, uint32 nonce) payable returns (uint64)","function receiveTbtc(bytes calldata encodedVm)"],a),this.tbtcTokenAddr=(0,n.N)(s)}static async fromRpc(t,e){let[a,r]=await n.V.chainFromRpc(t),s=e[r];if(s.network!==a)throw Error(`Network mismatch: ${s.network} != ${a}`);return new i(a,r,t,s.contracts)}async *transfer(t,e,a){let r=new n.aK(t).toString(),i=await this.gateway.sendTbtc.populateTransaction(a,(0,n.ah)(e.chain),e.address.toUniversalAddress().toUint8Array(),0n,0n);i.value=await this.core.getMessageFee(),yield*this.approve(r,a,this.gatewayAddress),yield this.createUnsignedTransaction((0,n.aL)(i,r),"TBTCBridge.Send")}async *redeem(t,e){if("GatewayTransfer"!==e.payloadName)throw Error("Invalid VAA payload");let a=new n.aK(t).toString(),r=await this.gateway.receiveTbtc.populateTransaction((0,n.at)(e));yield this.createUnsignedTransaction((0,n.aL)(r,a),"TBTCBridge.Redeem")}async *approve(t,e,a){let r=n.V.getTokenImplementation(this.provider,this.tbtcTokenAddr);if(await r.allowance(t,a)<e){let i=await r.approve.populateTransaction(a,e);yield this.createUnsignedTransaction((0,n.aL)(i,t),"TBTC.Approve")}}createUnsignedTransaction(t,e){return new n.X((0,n.aM)(t,this.chainId),this.network,this.chain,e,!1)}}(0,n.au)(n.aN,"TBTCBridge",i)}}]);