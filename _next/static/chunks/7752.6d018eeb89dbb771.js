"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7752],{44834:function(e,t,n){n.d(t,{a:function(){return u},d:function(){return s},g:function(){return c},n:function(){return o}});var r=n(73109),i=n(63753);let a=e=>"string"==typeof e?r.C.from(e):e;function s(e,t){return i.P.findProgramAddressSync(Array.isArray(e)?e.map(a):[a(e)],new i.P(t))[0]}function o(e,t){return{pubkey:new i.P(e),isWritable:!0,isSigner:t}}function u(e,t){return{pubkey:new i.P(e),isWritable:!1,isSigner:t}}function c(e){if(null===e)throw Error("account info is null");return e.data}},12274:function(e,t,n){n.d(t,{c:function(){return a}});var r=n(73109);function i(e){return[...r.ds,(0,r.dt)(e)]}function a(e,t){let[n,a]=(0,r.dq)(e),s=(0,r.dr)(i(e),t);return{protocolName:n,payloadName:a,payloadLiteral:e,...(0,r.dr)(r.du,t),...s,hash:(0,r.ap)((0,r.aj)(i(e),s))}}},87752:function(e,t,n){n.r(t),n.d(t,{B:function(){return d},S:function(){return em},a:function(){return l},b:function(){return er},c:function(){return S},d:function(){return z},e:function(){return g},f:function(){return _},g:function(){return eu},h:function(){return ec},i:function(){return w},j:function(){return V},k:function(){return U},l:function(){return L},m:function(){return I},n:function(){return x},o:function(){return P},p:function(){return el}});var r,i,a=n(73109),s=n(63753),o=n(5192),u=n(44834),c=n(12274);let d=new s.P("BPFLoaderUpgradeab1e11111111111111111111111");function g(e){return(0,u.d)([new s.P(e).toBuffer()],d)}class m extends Error{constructor(e){super(e),this.name="IdlError"}}function l(e,t){switch(t.type.kind){case"struct":return t.type.fields.map(t=>p(e,t.type)).reduce((e,t)=>e+t,0);case"enum":return Math.max(...t.type.variants.map(t=>t.fields?t.fields.map(t=>"object"==typeof t&&"name"in t?p(e,t.type):p(e,t)).reduce((e,t)=>e+t,0):0))+1;case"alias":return p(e,t.type.value)}}function p(e,t){switch(t){case"bool":case"u8":case"i8":case"bytes":case"string":return 1;case"i16":case"u16":return 2;case"u32":case"i32":case"f32":return 4;case"u64":case"i64":case"f64":return 8;case"u128":case"i128":return 16;case"u256":case"i256":case"publicKey":return 32;default:if("vec"in t)return 1;if("option"in t)return 1+p(e,t.option);if("coption"in t)return 4+p(e,t.coption);if("defined"in t){let n=e.types?.filter(e=>e.name===t.defined)??[];if(1!==n.length)throw new m(`Type not found: ${JSON.stringify(t)}`);return l(e,n[0])}if("array"in t){let n=t.array[0],r=t.array[1];return p(e,n)*r}throw Error(`Invalid type ${JSON.stringify(t)}`)}}function y(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,t){return 0===t?e.toLowerCase():e.toUpperCase()}).replace(/[\s\-_]+/g,"")}let h=[{name:"discriminator",binary:"bytes",size:4},{name:"consistencyLevel",binary:"uint",size:1,endianness:"little"},{name:"emitterAuthority",...a.aI},{name:"messageStatus",binary:"uint",size:1,endianness:"little"},{name:"gap",binary:"uint",size:3},{name:"timestamp",binary:"uint",size:4,endianness:"little"},{name:"nonce",binary:"uint",size:4,endianness:"little"},{name:"sequence",binary:"uint",size:8,endianness:"little"},{name:"emitterChain",binary:"uint",size:2,endianness:"little"},{name:"emitterAddress",...a.aI},{name:"payloadLength",binary:"uint",size:4,endianness:"little"},{name:"payload",binary:"bytes"}];function f(e){return(0,a.al)(h,e)}function S(e,t,n,r){let i="string"==typeof t?a.C.from(t,"hex"):a.C.from(t);if(32!=i.length)throw Error("address.length != 32");let s=a.C.alloc(8);return s.writeBigUInt64BE("number"==typeof r?BigInt(r):r),(0,u.d)([i,(()=>{let e=a.C.alloc(2);return e.writeUInt16BE(n),e})(),s],e)}async function w(e,t,n,r,i,a){return e.getAccountInfo(S(t,n,r,i),a).then(e=>!!(0,u.g)(e)[0])}function I(e){return(0,u.d)([a.C.from("Bridge")],e)}async function v(e,t,n){return e.getAccountInfo(I(t),n).then(e=>b.deserialize((0,u.g)(e)))}class M{guardianSetExpirationTime;fee;constructor(e,t){this.guardianSetExpirationTime=e,this.fee=t}static deserialize(e){if(12!=e.length)throw Error("data.length != 12");return new M(e.readUInt32LE(0),e.readBigUInt64LE(4))}}class b{guardianSetIndex;lastLamports;config;constructor(e,t,n){this.guardianSetIndex=e,this.lastLamports=t,this.config=n}static deserialize(e){if(24!=e.length)throw Error("data.length != 24");return new b(e.readUInt32LE(0),e.readBigUInt64LE(4),M.deserialize(e.subarray(12)))}}function P(e,t){return(0,u.d)([a.C.from("Sequence"),new s.P(e).toBytes()],t)}async function A(e,t,n,r){return e.getAccountInfo(P(t,n),r).then(e=>C.deserialize((0,u.g)(e)))}class C{sequence;bump;emitterType;constructor(e,t,n){this.sequence=e,this.bump=t,this.emitterType=n}static deserialize(e){let t,n;if(8!==e.length&&10!==e.length)throw Error("data.length != 8 or data.length != 10");let r=e.readBigUInt64LE(0);return 10===e.length&&(t=e[8],n=e[9]),new C(r,t,n)}value(){return this.sequence}}function x(e){return(0,u.d)([a.C.from("emitter")],e)}function E(e,t){let n=x(e);return{emitter:n,sequence:P(n,t)}}async function L(e,t,n,r){return A(e,x(t),n,r)}function U(e){return(0,u.d)([a.C.from("fee_collector")],e)}class k{static serialize(e,t,n){if(0==e.length)throw Error("signatures.length == 0");if(e.length!=t.length)throw Error("signatures.length != keys.length");if(32!=n.length)throw Error("message.length != 32");let r=e.length,i=1+11*r,s=i+85*r,o=a.C.alloc(s+32);o.writeUInt8(r,0),o.write(n.toString("hex"),s,"hex");for(let n=0;n<r;++n){let r=e.at(n);if(r?.length!=65)throw Error(`signatures[${n}].length != 65`);let a=t.at(n);if(a?.length!=20)throw Error(`keys[${n}].length != 20`);let u=i+85*n,c=u+65;o.writeUInt16LE(u,1+11*n),o.writeUInt8(0,3+11*n),o.writeUInt16LE(c,4+11*n),o.writeUInt8(0,6+11*n),o.writeUInt16LE(s,7+11*n),o.writeUInt16LE(32,9+11*n),o.writeUInt8(0,10+11*n),o.write(r.toString("hex"),u,"hex"),o.write(a.toString("hex"),c,"hex")}return o}}function B(e,t){return(0,u.d)([a.C.from("GuardianSet"),(()=>{let e=a.C.alloc(4);return e.writeUInt32BE(t),e})()],e)}async function T(e,t,n,r){return e.getAccountInfo(B(t,n),r).then(e=>q.deserialize((0,u.g)(e)))}class q{index;keys;creationTime;expirationTime;constructor(e,t,n,r){this.index=e,this.keys=t,this.creationTime=n,this.expirationTime=r}static deserialize(e){let t=e.readUInt32LE(0),n=e.readUInt32LE(4),r=8+20*n,i=e.readUInt32LE(r),a=e.readUInt32LE(4+r),s=[];for(let t=0;t<n;++t){let n=8+20*t;s.push(e.subarray(n,n+20))}return new q(t,s,i,a)}}function z(e,t){return(0,u.d)([a.C.from("PostedVAA"),t],e)}async function K(e,t,n){return e.getAccountInfo(new s.P(t),n).then(e=>F.deserialize((0,u.g)(e)))}class F{signatures;hash;guardianSetIndex;constructor(e,t,n){this.signatures=e,this.hash=t,this.guardianSetIndex=n}static deserialize(e){let t=e.readUInt32LE(0),n=[...e.subarray(4,4+t)].map(e=>0!=e),r=4+t;return new F(n,e.subarray(r,r+32),e.readUInt32LE(r+32))}}function _(e){return(0,u.d)([a.C.from("upgrade")],e)}function V(e,t,n){return s.S.transfer({fromPubkey:new s.P(t),toPubkey:U(e),lamports:n})}class D{idl;constructor(e){this.idl=e}async encode(e,t){throw Error(`Invalid account name: ${e}`)}decode(e,t){return this.decodeUnchecked(e,t)}decodeUnchecked(e,t){throw Error(`Invalid account name: ${e}`)}memcmp(e,t){if("postVaa"===e)return{dataSize:56};throw Error(`Invalid account name: ${e}`)}size(e){return l(this.idl,e)??0}}class W{constructor(e){}decode(e){throw Error("Wormhole program does not have events")}}class G{static fieldLayout(e,t){let n=void 0!==e.name?y(e.name):void 0;switch(e.type){case"bool":return o.d.bool(n);case"u8":return o.d.u8(n);case"i8":return o.d.i8(n);case"u16":return o.d.u16(n);case"i16":return o.d.i16(n);case"u32":return o.d.u32(n);case"i32":return o.d.i32(n);case"f32":return o.d.f32(n);case"u64":return o.d.u64(n);case"i64":return o.d.i64(n);case"f64":return o.d.f64(n);case"u128":return o.d.u128(n);case"i128":return o.d.i128(n);case"u256":return o.d.u256(n);case"i256":return o.d.i256(n);case"bytes":return o.d.vecU8(n);case"string":return o.d.str(n);case"publicKey":return o.d.publicKey(n);default:if("vec"in e.type)return o.d.vec(G.fieldLayout({name:void 0,type:e.type.vec},t),n);if("option"in e.type)return o.d.option(G.fieldLayout({name:void 0,type:e.type.option},t),n);if("array"in e.type){let r=e.type.array[0],i=e.type.array[1],a=G.fieldLayout({name:void 0,type:r},t);return o.d.array(a,i,n)}throw Error(`Not yet implemented: ${e}`)}}}class ${ixLayout;constructor(e){this.ixLayout=$.parseIxLayout(e)}static parseIxLayout(e){return new Map((e.instructions?e.instructions:[]).map(t=>{let n=t.args.map(t=>G.fieldLayout(t,Array.from([...e.accounts??[],...e.types??[]]))),r=y(t.name);return[r,o.d.struct(n,r)]}).concat(e.instructions.map(t=>{let n=t.args.map(t=>G.fieldLayout(t,Array.from([...e.accounts??[],...e.types??[]]))),r=y(t.name);return[r,o.d.struct(n,r)]})))}encode(e,t){let n=a.C.alloc(1e3),r=y(e),s=this.ixLayout.get(r);if(!s)throw Error(`Unknown method: ${r}`);let o=s.encode(t,n),u=n.slice(0,o);return function(e,t){let n=a.C.alloc(1+(void 0===t?0:t.length));return n.writeUInt8(e,0),void 0!==t&&n.write(t.toString("hex"),1,"hex"),n}(i[r.charAt(0).toUpperCase()+r.slice(1)],u)}encodeState(e,t){throw Error("Wormhole program does not have state")}decode(e,t="hex"){"string"==typeof e&&(e="hex"===t?a.C.from(e,"hex"):a.cO.decode(e));let n=a.C.from(e.slice(0,1)).readInt8(),r=a.C.from(e.slice(1)),s=y(i[n]??"");return this.ixLayout.get(s)?{data:this.ixLayout.get(s)?.decode(r),name:s}:null}}(r=i||(i={}))[r.Initialize=0]="Initialize",r[r.PostMessage=1]="PostMessage",r[r.PostVaa=2]="PostVaa",r[r.SetFees=3]="SetFees",r[r.TransferFees=4]="TransferFees",r[r.UpgradeContract=5]="UpgradeContract",r[r.UpgradeGuardianSet=6]="UpgradeGuardianSet",r[r.VerifySignatures=7]="VerifySignatures",r[r.PostMessageUnreliable=8]="PostMessageUnreliable";class N{constructor(e){}encode(e,t){throw Error("Wormhole program does not have state")}decode(e){throw Error("Wormhole program does not have state")}}class O{constructor(e){}encode(e,t){throw Error("Wormhole program does not have user-defined types")}decode(e,t){throw Error("Wormhole program does not have user-defined types")}}class j{instruction;accounts;state;events;types;constructor(e){this.instruction=new $(e),this.accounts=new D(e),this.state=new N(e),this.events=new W(e),this.types=new O(e)}}let R={version:"0.1.0",name:"wormhole",instructions:[{name:"initialize",accounts:[{name:"bridge",isMut:!0,isSigner:!1},{name:"guardianSet",isMut:!0,isSigner:!1},{name:"feeCollector",isMut:!0,isSigner:!1},{name:"payer",isMut:!0,isSigner:!0},{name:"clock",isMut:!1,isSigner:!1},{name:"rent",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"guardianSetExpirationTime",type:"u32"},{name:"fee",type:"u64"},{name:"initialGuardians",type:{vec:{array:["u8",20]}}}]},{name:"postMessage",accounts:[{name:"bridge",isMut:!0,isSigner:!1},{name:"message",isMut:!0,isSigner:!0},{name:"emitter",isMut:!1,isSigner:!0},{name:"sequence",isMut:!0,isSigner:!1},{name:"payer",isMut:!0,isSigner:!0},{name:"feeCollector",isMut:!0,isSigner:!1},{name:"clock",isMut:!1,isSigner:!1},{name:"rent",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"nonce",type:"u32"},{name:"payload",type:"bytes"},{name:"consistencyLevel",type:"u8"}]},{name:"postVaa",accounts:[{name:"guardianSet",isMut:!1,isSigner:!1},{name:"bridge",isMut:!1,isSigner:!1},{name:"signatureSet",isMut:!1,isSigner:!1},{name:"vaa",isMut:!0,isSigner:!1},{name:"payer",isMut:!0,isSigner:!0},{name:"clock",isMut:!1,isSigner:!1},{name:"rent",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"version",type:"u8"},{name:"guardianSetIndex",type:"u32"},{name:"timestamp",type:"u32"},{name:"nonce",type:"u32"},{name:"emitterChain",type:"u16"},{name:"emitterAddress",type:{array:["u8",32]}},{name:"sequence",type:"u64"},{name:"consistencyLevel",type:"u8"},{name:"payload",type:"bytes"}]},{name:"setFees",accounts:[{name:"payer",isMut:!0,isSigner:!0},{name:"bridge",isMut:!0,isSigner:!1},{name:"vaa",isMut:!1,isSigner:!1},{name:"claim",isMut:!0,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"transferFees",accounts:[{name:"payer",isMut:!0,isSigner:!0},{name:"bridge",isMut:!0,isSigner:!1},{name:"vaa",isMut:!1,isSigner:!1},{name:"claim",isMut:!0,isSigner:!1},{name:"feeCollector",isMut:!0,isSigner:!1},{name:"recipient",isMut:!0,isSigner:!1},{name:"rent",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"upgradeContract",accounts:[{name:"payer",isMut:!0,isSigner:!0},{name:"bridge",isMut:!0,isSigner:!1},{name:"vaa",isMut:!1,isSigner:!1},{name:"claim",isMut:!0,isSigner:!1},{name:"upgradeAuthority",isMut:!1,isSigner:!1},{name:"spill",isMut:!0,isSigner:!1},{name:"implementation",isMut:!0,isSigner:!1},{name:"programData",isMut:!0,isSigner:!1},{name:"wormholeProgram",isMut:!0,isSigner:!1},{name:"rent",isMut:!1,isSigner:!1},{name:"clock",isMut:!1,isSigner:!1},{name:"bpfLoaderUpgradeable",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"upgradeGuardianSet",accounts:[{name:"payer",isMut:!0,isSigner:!0},{name:"bridge",isMut:!0,isSigner:!1},{name:"vaa",isMut:!1,isSigner:!1},{name:"claim",isMut:!0,isSigner:!1},{name:"guardianSetOld",isMut:!0,isSigner:!1},{name:"guardianSetNew",isMut:!0,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"verifySignatures",accounts:[{name:"payer",isMut:!0,isSigner:!0},{name:"guardianSet",isMut:!1,isSigner:!1},{name:"signatureSet",isMut:!0,isSigner:!0},{name:"instructions",isMut:!1,isSigner:!1},{name:"rent",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"signatureStatus",type:{array:["i8",19]}}]},{name:"postMessageUnreliable",accounts:[{name:"bridge",isMut:!0,isSigner:!1},{name:"message",isMut:!0,isSigner:!0},{name:"emitter",isMut:!1,isSigner:!0},{name:"sequence",isMut:!0,isSigner:!1},{name:"payer",isMut:!0,isSigner:!0},{name:"feeCollector",isMut:!0,isSigner:!1},{name:"clock",isMut:!1,isSigner:!1},{name:"rent",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"nonce",type:"u32"},{name:"payload",type:"bytes"},{name:"consistencyLevel",type:"u8"}]}],accounts:[{name:"PostedMessage",type:{kind:"struct",fields:[{name:"vaaVersion",type:"u8"},{name:"consistencyLevel",type:"u8"},{name:"vaaTime",type:"u32"},{name:"vaaSignatureAccount",type:"publicKey"},{name:"submissionTime",type:"u32"},{name:"nonce",type:"u32"},{name:"sequence",type:"u64"},{name:"emitterChain",type:"u16"},{name:"emitterAddress",type:{array:["u8",32]}},{name:"payload",type:"bytes"}]}},{name:"PostedVAA",type:{kind:"struct",fields:[{name:"vaaVersion",type:"u8"},{name:"consistencyLevel",type:"u8"},{name:"vaaTime",type:"u32"},{name:"vaaSignatureAccount",type:"publicKey"},{name:"submissionTime",type:"u32"},{name:"nonce",type:"u32"},{name:"sequence",type:"u64"},{name:"emitterChain",type:"u16"},{name:"emitterAddress",type:{array:["u8",32]}},{name:"payload",type:"bytes"}]}}]};function J(e,t){return new o.P(R,new s.P(e),void 0===t?{connection:null}:t,H())}function Z(e,t){return J(e,(0,o.c)(t))}function H(){return new j(R)}function Q(e,t,n){return{payer:new s.P(t),bridge:I(e),vaa:z(e,a.C.from(n.hash)),claim:S(e,n.emitterAddress.toString(),(0,a.ah)(n.emitterChain),n.sequence),systemProgram:s.S.programId}}function X(e,t,n,r){return{payer:new s.P(t),bridge:I(e),vaa:z(e,a.C.from(r.hash)),claim:S(e,r.emitterAddress.toString(),(0,a.ah)(r.emitterChain),r.sequence),feeCollector:U(e),recipient:new s.P(n),rent:s.d,systemProgram:s.S.programId}}function Y(e,t,n){return{payer:new s.P(t),bridge:I(e),vaa:z(e,a.C.from(n.hash)),claim:S(e,n.emitterAddress.toString(),(0,a.ah)(n.emitterChain),n.sequence),guardianSetOld:B(e,n.guardianSet),guardianSetNew:B(e,n.guardianSet+1),systemProgram:s.S.programId}}function ee(e,t,n,r){let{newContract:i}=n.payload.actionArgs;return{payer:new s.P(t),bridge:I(e),vaa:z(e,a.C.from(n.hash)),claim:S(e,n.emitterAddress.toString(),(0,a.ah)(n.emitterChain),n.sequence),upgradeAuthority:_(e),spill:new s.P(void 0===r?t:r),implementation:new s.B(i).unwrap(),programData:g(e),wormholeProgram:new s.P(e),rent:s.d,clock:s.b,bpfLoaderUpgradeable:d,systemProgram:s.S.programId}}function et(e,t){return{bridge:I(e),guardianSet:B(e,0),feeCollector:U(e),payer:new s.P(t),clock:s.b,rent:s.d,systemProgram:s.S.programId}}function en(e,t,n,r,i,s,o){let u=Z(t,e).methods.postMessage(s,a.C.from(i),o);return u._ixFn(...u._args,{accounts:er(t,n,r),signers:void 0,remainingAccounts:void 0,preInstructions:void 0,postInstructions:void 0})}function er(e,t,n,r){let i;return r?{emitter:r,sequence:i}=E(r,e):i=P(r=t,e),{bridge:I(e),message:new s.P(n),emitter:new s.P(r),sequence:i,payer:new s.P(t),feeCollector:U(e),clock:s.b,rent:s.d,systemProgram:s.S.programId}}function ei(e,t,n,r,i){let o=Z(t,e).methods.postVaa(1,r.guardianSet,r.timestamp,r.nonce,(0,a.ah)(r.emitterChain),[...r.emitterAddress.toUint8Array()],new s.ac(r.sequence.toString()),r.consistencyLevel,a.C.from((0,a.dp)(r.payloadLiteral,r.payload)));return o._ixFn(...o._args,{accounts:ea(t,n,i,r),signers:void 0,remainingAccounts:void 0,preInstructions:void 0,postInstructions:void 0})}function ea(e,t,n,r){return{guardianSet:B(e,r.guardianSet),bridge:I(e),signatureSet:new s.P(n),vaa:z(e,a.C.from(r.hash)),payer:new s.P(t),clock:s.b,rent:s.d,systemProgram:s.S.programId}}async function es(e,t,n,r,i,o){let u=r.guardianSet,c=await T(e,t,u,o),d=r.signatures,g=c.keys,m=[];for(let o=0;o<Math.ceil(d.length/7);++o){var l;let u=7*o,c=Math.min(d.length,(o+1)*7),p=Array(19).fill(-1),y=[],h=[];for(let e=0;e<c-u;++e){let t=d.at(e+u);y.push(a.C.from(t.signature.encode())),h.push(g.at(t.guardianIndex)),p[t.guardianIndex]=e}m.push((l=a.C.from(r.hash),new s.T({keys:[],programId:s.aA.programId,data:k.serialize(y,h,l)}))),m.push(function(e,t,n,r,i,a){let s=Z(t,e).methods.verifySignatures(a);return s._ixFn(...s._args,{accounts:eo(t,n,i,r),signers:void 0,remainingAccounts:void 0,preInstructions:void 0,postInstructions:void 0})}(e,t,n,r,i,p))}return m}function eo(e,t,n,r){return{payer:new s.P(t),guardianSet:B(e,r.guardianSet),signatureSet:new s.P(n),instructions:s.aB,rent:s.d,systemProgram:s.S.programId}}function eu(e,t){let{emitter:n,sequence:r}=E(e,t);return{wormholeBridge:I(t),wormholeEmitter:n,wormholeSequence:r,wormholeFeeCollector:U(t)}}function ec(e,t,n,r){let i=er(t,n,r,e);return{payer:i.payer,wormholeBridge:i.bridge,wormholeMessage:i.message,wormholeEmitter:i.emitter,wormholeSequence:i.sequence,wormholeFeeCollector:i.feeCollector,clock:i.clock,rent:i.rent,systemProgram:i.systemProgram}}let ed=Object.freeze(Object.defineProperty({__proto__:null,BridgeConfig:M,BridgeData:b,GuardianSetData:q,SequenceTracker:C,SignatureSetData:F,coder:H,createBridgeFeeTransferInstruction:V,createInitializeInstruction:function(e,t,n,r,i,a){let o=Z(t,e).methods.initialize(r,new s.ac(i.toString()),[...a.map(e=>[...new Uint8Array(e)])]);return o._ixFn(...o._args,{accounts:et(t,n),signers:void 0,remainingAccounts:void 0,preInstructions:void 0,postInstructions:void 0})},createPostMessageInstruction:en,createPostVaaInstruction:ei,createReadOnlyWormholeProgramInterface:Z,createSetFeesInstruction:function(e,t,n,r){let i=Z(t,e).methods.setFees();return i._ixFn(...i._args,{accounts:Q(t,n,r),signers:void 0,remainingAccounts:void 0,preInstructions:void 0,postInstructions:void 0})},createTransferFeesInstruction:function(e,t,n,r,i){let a=Z(t,e).methods.transferFees();return a._ixFn(...a._args,{accounts:X(t,n,r,i),signers:void 0,remainingAccounts:void 0,preInstructions:void 0,postInstructions:void 0})},createUpgradeContractInstruction:function(e,t,n,r){let i=Z(t,e).methods.upgradeContract();return i._ixFn(...i._args,{accounts:ee(t,n,r),signers:void 0,remainingAccounts:void 0,preInstructions:void 0,postInstructions:void 0})},createUpgradeGuardianSetInstruction:function(e,t,n,r){let i=Z(t,e).methods.upgradeGuardianSet();return i._ixFn(...i._args,{accounts:Y(t,n,r),signers:void 0,remainingAccounts:void 0,preInstructions:void 0,postInstructions:void 0})},createVerifySignaturesInstructions:es,createWormholeProgramInterface:J,deriveClaimKey:S,deriveEmitterSequenceKey:P,deriveFeeCollectorKey:U,deriveGuardianSetKey:B,derivePostedVaaKey:z,deriveUpgradeAuthorityKey:_,deriveWormholeBridgeDataKey:I,deriveWormholeEmitterKey:x,getClaim:w,getEmitterKeys:E,getGuardianSet:T,getInitializeAccounts:et,getPostMessageAccounts:er,getPostMessageCpiAccounts:ec,getPostVaaAccounts:ea,getProgramSequenceTracker:L,getSequenceTracker:A,getSetFeesAccounts:Q,getSignatureSetData:K,getTransferFeesAccounts:X,getUpgradeContractAccounts:ee,getUpgradeGuardianSetAccounts:Y,getVerifySignatureAccounts:eo,getWormholeBridgeData:v,getWormholeDerivedAccounts:eu},Symbol.toStringTag,{value:"Module"})),eg="Program log: Sequence: ";class em{network;chain;connection;contracts;chainId;coreBridge;address;bridgeData;constructor(e,t,n,r){this.network=e,this.chain=t,this.connection=n,this.contracts=r,this.chainId=(0,a.ah)(t);let i=r.coreBridge;if(!i)throw Error(`CoreBridge contract Address for chain ${t} not found`);this.address=i,this.coreBridge=Z(i,n)}async getGuardianSet(e){let t=await T(this.connection,this.coreBridge.programId,e);return{index:t.index,keys:t.keys.map(e=>e.toString("hex")),expiry:BigInt(t.expirationTime)}}static async fromRpc(e,t){let[n,r]=await s.j.chainFromRpc(e),i=t[r];if(i.network!==n)throw Error(`Network mismatch for chain ${r}: ${i.network} != ${n}`);return new em(n,r,e,t[r].contracts)}async ensureBridgeConfig(){this.bridgeData||(this.bridgeData=await v(this.connection,this.coreBridge.programId))}async getMessageFee(){return await this.ensureBridgeConfig(),this.bridgeData.config.fee}async getGuardianSetIndex(){return await this.ensureBridgeConfig(),this.bridgeData.guardianSetIndex}async *publishMessage(e,t,n,r){let i=s.K.generate(),a=new s.B(e).unwrap(),o=en(this.connection,this.coreBridge.programId,a,i.publicKey,t,n,r),u=await this.getMessageFee(),c=V(this.coreBridge.programId,a,u),d=new s.D;d.feePayer=a,d.add(c,o),yield this.createUnsignedTx({transaction:d,signers:[i]},"Core.PublishMessage")}async *verifyMessage(e,t){yield*this.postVaa(e,t)}async *postVaa(e,t){let n=z(this.coreBridge.programId,a.C.from(t.hash));if(await this.connection.getAccountInfo(n))return;let r=new s.B(e).unwrap(),i=s.K.generate(),o=await es(this.connection,this.coreBridge.programId,r,t,i.publicKey);for(let e=0;e<o.length;e+=2){let t=new s.D().add(...o.slice(e,e+2));t.feePayer=r,yield this.createUnsignedTx({transaction:t,signers:[i]},"Core.VerifySignature",!0)}let u=new s.D().add(ei(this.connection,this.coreBridge.programId,r,t,i.publicKey));u.feePayer=r,yield this.createUnsignedTx({transaction:u},"Core.PostVAA")}static parseSequenceFromLog(e,t){let{meta:n,transaction:{message:r}}=t;if(!n?.innerInstructions?.length)return[];let i=r.staticAccountKeys;if(0===i.filter(t=>t.toString()===e).length)return[];let a=n?.logMessages?.filter(e=>e.startsWith(eg))?.[0]?.replace(eg,"");if(!a)return[];let o=[];for(let t of n?.innerInstructions){let n=t.instructions;o.push(...n.filter(t=>t.programIdIndex in i&&i[t.programIdIndex].toString()===e))}return o.length<1?[]:i.length<3?[]:o.map(e=>[new s.B(i[e.accounts[2]]).toUniversalAddress(),BigInt(a)]).filter(e=>null!==e)}async getMessageAccountKeys(e){let t;if("string"!=typeof e.transaction.message.version){if(e.meta.loadedAddresses)t=e.transaction.message.getAccountKeys({accountKeysFromLookups:e.meta.loadedAddresses});else{let n=await Promise.all(e.transaction.message.addressTableLookups.map(async e=>{let t=await this.connection.getAddressLookupTable(e.accountKey);if(!t||!t.value)throw Error("Could not resolve lookup table: "+e.accountKey.toBase58());return t.value}));t=e.transaction.message.getAccountKeys({addressLookupTableAccounts:n})}}else t=e.transaction.message.getAccountKeys();return t}async findInstructions(e,t){let{meta:n,transaction:{message:r}}=t,i=this.coreBridge.programId;return[...n.innerInstructions?.flatMap(t=>t.instructions.filter(t=>i.toString()===e.get(t.programIdIndex).toString())).map(e=>({programIdIndex:e.programIdIndex,accountKeyIndexes:e.accounts})),...r.compiledInstructions.filter(t=>i.toString()===e.get(t.programIdIndex).toString())]}async parsePostMessageAccount(e){let t=await this.connection.getAccountInfo(e);if(!t?.data)throw Error("No data found in message account");let{timestamp:n,emitterAddress:r,emitterChain:i,consistencyLevel:s,sequence:o,nonce:u,payload:d}=f(new Uint8Array(t?.data));return(0,c.c)("Uint8Array",{guardianSet:await this.getGuardianSetIndex(),emitterChain:(0,a.L)(i),timestamp:n,emitterAddress:r,consistencyLevel:s,sequence:o,nonce:u,payload:d,signatures:[]})}async parseTransaction(e){let t=await this.connection.getTransaction(e,{maxSupportedTransactionVersion:0});if(!t||!t.meta||!t.meta.innerInstructions)throw Error("transaction not found");try{let e=em.parseSequenceFromLog(this.coreBridge.programId.toBase58(),t);if(e.length>0){let[t,n]=e[0];return[{chain:this.chain,emitter:t,sequence:n}]}}catch{}let n=await this.getMessageAccountKeys(t),r=await this.findInstructions(n,t);if(!r||0===r.length)throw Error("no bridge messages found");let i=r.map(async e=>{let t=n.get(e.accountKeyIndexes[1]),r=await this.parsePostMessageAccount(t);return{chain:r.emitterChain,emitter:r.emitterAddress,sequence:r.sequence}});return await Promise.all(i)}async parseMessages(e){let t=await this.connection.getTransaction(e,{maxSupportedTransactionVersion:0});if(!t||!t.meta||!t.meta.innerInstructions)throw Error("transaction not found");let n=await this.getMessageAccountKeys(t),r=await this.findInstructions(n,t);if(!r||0===r.length)throw Error("no bridge messages found");let i=r.map(async e=>{let t=n.get(e.accountKeyIndexes[1]);return await this.parsePostMessageAccount(t)});return await Promise.all(i)}createUnsignedTx(e,t,n=!1){return new s.l(e,this.network,this.chain,t,n)}}(0,a.au)(s._,"WormholeCore",em);let el=Object.freeze(Object.defineProperty({__proto__:null,IDL:R,SolanaWormholeCore:em,deserializePostMessage:f,postMessageLayout:h,utils:ed},Symbol.toStringTag,{value:"Module"}))}}]);