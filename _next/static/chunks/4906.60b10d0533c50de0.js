"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4906],{14906:function(e,t,r){r.r(t),r.d(t,{EvmPorticoBridge:function(){return h}});var n=r(73109),a=r(54879),i=r(79286);let o=new n.I(["function start((bytes32,address,address,address,address,address,uint256,uint256,uint256,uint256)) returns (address,uint16,uint64)","function receiveMessageAndSwap(bytes)"]),s=new n.I(["function quoteExactInputSingle((address,address,uint256,uint24,uint160)) public view returns (uint256,uint160,uint32,uint256)"]);class c{static async quoteRelayer(e,t,r){if((0,n.i)(t)||(0,n.i)(r))throw Error("how did you get here tho?");let a=n.m.encode(t.toUniversalAddress().toUint8Array(),!1),i=n.m.encode(r.toUniversalAddress().toUint8Array(),!1),o={targetChain:(0,n.ah)(e),sourceToken:a,targetToken:i};try{let e=await n.J.post("https://gfx.relayers.xlabs.xyz/api/v1/swap/quote",o);return BigInt(e.data.fee)}catch(e){throw n.J.isAxiosError(e)?Error(`Error getting relayer fee: ${e.response?.statusText}`):e}}}let d={ETH:[n.W.tokenId("Arbitrum","native"),n.W.tokenId("Base","native"),n.W.tokenId("Ethereum","native"),n.W.tokenId("Optimism","native")],WETH:[n.W.tokenId("Arbitrum","0x82aF49447D8a07e3bd95BD0d56f35241523fBab1"),n.W.tokenId("Avalanche","0x49D5c2BdFfac6CE2BFdB6640F4F80f226bc10bAB"),n.W.tokenId("Base","0x4200000000000000000000000000000000000006"),n.W.tokenId("Bsc","0x2170Ed0880ac9A755fd29B2688956BD959F933F8"),n.W.tokenId("Ethereum","0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),n.W.tokenId("Optimism","0x4200000000000000000000000000000000000006"),n.W.tokenId("Polygon","0x7ceB23fD6bC0adD59E62ac25578270cFf1b9f619")],wstETH:[n.W.tokenId("Arbitrum","0x5979D7b546E38E414F7E9822514be443A4800529"),n.W.tokenId("Base","0xc1CBa3fCea344f92D9239c08C0568f6F2F0ee452"),n.W.tokenId("Ethereum","0x7f39C581F595B53c5cb19bD0b3f8dA6c935E2Ca0"),n.W.tokenId("Optimism","0x1F32b1c2345538c0c6f582fCB022739c4A194Ebb"),n.W.tokenId("Polygon","0x03b54A6e9a984069379fae1a4fC4dBAE93B3bCCD")],USDT:[n.W.tokenId("Arbitrum","0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9"),n.W.tokenId("Avalanche","0x9702230A8Ea53601f5cD2dc00fDBc13d4dF4A8c7"),n.W.tokenId("Base","0xfde4C96c8593536E31F229EA8f37b2ADa2699bb2"),n.W.tokenId("Bsc","0x55d398326f99059fF775485246999027B3197955"),n.W.tokenId("Ethereum","0xdAC17F958D2ee523a2206206994597C13D831ec7"),n.W.tokenId("Optimism","0x94b008aA00579c1307B0EF2c499aD98a8ce58e58"),n.W.tokenId("Polygon","0xc2132D05D31c914a87C6611C10748AEb04B58e8F"),n.W.tokenId("Celo","0x48065fbBE25f71C9282ddf5e1cD6D6A887483D5e")]};class h{network;chain;provider;contracts;chainId;core;tokenBridge;constructor(e,t,r,o){if(this.network=e,this.chain=t,this.provider=r,this.contracts=o,!o.portico)throw Error("Unsupported chain, no contract addresses for: "+t);this.core=new a.EvmWormholeCore(e,t,r,o),this.tokenBridge=new i.EvmTokenBridge(e,t,r,o),this.chainId=n.l.get(e,t)}static async fromRpc(e,t){let[r,a]=await n.V.chainFromRpc(e),i=t[a];if(i.network!==r)throw Error(`Network mismatch: ${i.network} != ${r}`);return new h(r,a,e,i.contracts)}async *transfer(e,t,r,a,i,s,c){let{minAmountStart:d,minAmountFinish:h}=c.swapAmounts;if(0n===d||0n===h)throw Error("Invalid min swap amount");let u=new n.aK(e).toString(),[l,p]=(0,n.aV)(this.network,this.chain,r),[f,g]=(0,n.aV)(this.network,t.chain,i),k=(0,n.N)(p),w=(0,n.N)(await this.getTransferrableToken(k)),E=(0,n.N)(t),m=(0,n.N)(g),A=new Date().valueOf()%16,b=n.dc.serializeFlagSet({flags:{shouldWrapNative:l,shouldUnwrapNative:f},recipientChain:(0,n.ah)(t.chain),bridgeNonce:A,feeTierStart:100,feeTierFinish:100,padding:new Uint8Array(19)}),C=o.encodeFunctionData("start",[[b,k.toLowerCase(),w,m.toLowerCase(),E,s,a.toString(),d.toString(),h.toString(),c.relayerFee.toString()]]),B=this.getTokenGroup(p.address.toString()),I=this.getPorticoAddress(B);l||(yield*this.approve(k,u,a,I));let y=await this.core.getMessageFee();yield this.createUnsignedTransaction((0,n.aL)({to:I,data:C,value:y+(l?a:0n)},u),"PorticoBridge.Transfer")}async *redeem(e,t){let r=(0,n.L)(t.payload.payload.flagSet.recipientChain),a=t.payload.payload.finalTokenAddress.toNative(r).toString(),i=this.getTokenGroup(a),s=this.getPorticoAddress(i),c=await new n.E(s,o.fragments,this.provider).getFunction("receiveMessageAndSwap").populateTransaction((0,n.at)(t)),d=new n.aK(e).toString();yield this.createUnsignedTransaction((0,n.aL)(c,d),"PorticoBridge.Redeem")}async isTransferCompleted(e){return await this.tokenBridge.tokenBridge.isTransferCompleted((0,n.H)(e.hash))}async quoteSwap(e,t,r,a){let[,i]=(0,n.aV)(this.network,this.chain,e),[,o]=(0,n.aV)(this.network,this.chain,t),c=(0,n.N)(i),d=(0,n.N)(o);if((0,n.dd)(c,d))return a;let h=this.getQuoterAddress(r);return(await new n.E(h,s.fragments,this.provider).getFunction("quoteExactInputSingle").staticCall([c,d,a,100,0]))[0]}async quoteRelay(e,t){return await c.quoteRelayer(this.chain,e,t)}async getTransferrableToken(e){let t=n.W.tokenId(this.chain,e),[,r]=(0,n.aV)(this.network,this.chain,t);if("Ethereum"===this.chain)return r;let a=Object.values(d).find(e=>e.find(e=>e.chain===this.chain&&(0,n.N)(e)===(0,n.N)(r)));if(!a)throw Error(`No token group found for ${e} on ${this.chain}`);let i=a.find(e=>"Ethereum"===e.chain);if(!i)throw Error(`No Ethereum origin token found for ${e} on ${this.chain}`);let o=await this.tokenBridge.getWrappedAsset(i);return n.W.tokenId(this.chain,o.toString())}supportedTokens(){let e=[];for(let[t,r]of Object.entries(d))for(let n of r)n.chain===this.chain&&e.push({group:t,token:n});return e}getTokenGroup(e){let t=this.supportedTokens().find(t=>(0,n.N)(t.token)===e);if(!t)throw Error("Token not found");return t.group}async *approve(e,t,r,a){let i=n.V.getTokenImplementation(this.provider,e);if(await i.allowance(t,a)<r){let e=await i.approve.populateTransaction(a,r);yield this.createUnsignedTransaction((0,n.aL)(e,t),"PorticoBridge.Approve")}}createUnsignedTransaction(e,t){return new n.X((0,n.aM)(e,this.chainId),this.network,this.chain,t,!1)}getPorticoAddress(e){let t=this.contracts.portico;return"USDT"===e&&t.porticoPancakeSwap||t.porticoUniswap}getQuoterAddress(e){let t=this.contracts.portico;return"USDT"===e&&t.pancakeSwapQuoterV2||t.uniswapQuoterV2}}(0,n.au)(n.aN,"PorticoBridge",h)}}]);