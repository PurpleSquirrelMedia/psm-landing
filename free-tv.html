<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free TV - Purple Squirrel Media</title>
    <link rel="icon" type="image/png" href="img/logo.png">
    <link rel="apple-touch-icon" href="img/logo.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <link rel="stylesheet" href="css/styles.css">
    <style>
        /* Free TV Styles */
        .freetv-hero {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(16, 16, 32, 0.95)),
                        url('https://images.unsplash.com/photo-1593784991095-a205069470b6?w=1920') center/cover;
            min-height: 40vh;
            display: flex;
            align-items: center;
            padding: 6rem 2rem 3rem;
        }

        .freetv-hero-content {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }

        .freetv-hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #22c55e, #4ade80);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .free-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
            margin-top: 1rem;
        }

        /* Channel Guide */
        .channel-guide {
            padding: 3rem 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .guide-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .category-pills {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .category-pill {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            color: #a78bfa;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .category-pill:hover, .category-pill.active {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            border-color: transparent;
        }

        /* Live Now Indicator */
        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: #ef4444;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }

        /* Channel Grid */
        .channel-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .channel-card {
            background: rgba(30, 30, 50, 0.8);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(139, 92, 246, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .channel-card:hover {
            transform: translateY(-5px);
            border-color: rgba(34, 197, 94, 0.5);
            box-shadow: 0 15px 40px rgba(34, 197, 94, 0.2);
        }

        .channel-preview {
            position: relative;
            aspect-ratio: 16/9;
            background: #000;
            overflow: hidden;
        }

        .channel-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .channel-logo {
            position: absolute;
            bottom: 10px;
            left: 10px;
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .channel-logo img {
            max-width: 100%;
            max-height: 100%;
        }

        .now-playing {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.85rem;
        }

        .now-playing .title {
            color: white;
            font-weight: 500;
        }

        .now-playing .time {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.75rem;
        }

        .channel-info {
            padding: 1rem;
        }

        .channel-info h3 {
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .channel-info .genre {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.85rem;
        }

        /* Player Section */
        .player-section {
            background: #000;
            padding: 2rem;
            display: none;
        }

        .player-section.active {
            display: block;
        }

        .main-player {
            max-width: 1200px;
            margin: 0 auto;
        }

        .player-wrapper {
            position: relative;
            aspect-ratio: 16/9;
            background: #111;
            border-radius: 12px;
            overflow: hidden;
        }

        .player-wrapper video,
        .player-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .player-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
        }

        .current-channel {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .current-channel h2 {
            font-size: 1.5rem;
        }

        .channel-nav {
            display: flex;
            gap: 0.5rem;
        }

        .channel-nav button {
            background: rgba(139, 92, 246, 0.2);
            border: 1px solid rgba(139, 92, 246, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .channel-nav button:hover {
            background: rgba(139, 92, 246, 0.4);
        }

        /* Upgrade Banner */
        .upgrade-banner {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(30, 30, 50, 0.9));
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 16px;
            padding: 2rem;
            margin: 3rem auto;
            max-width: 800px;
            text-align: center;
        }

        .upgrade-banner h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .upgrade-banner p {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 1.5rem;
        }

        .upgrade-banner .btn {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            padding: 12px 30px;
            border-radius: 10px;
            text-decoration: none;
            font-weight: 600;
            display: inline-block;
            transition: all 0.3s ease;
        }

        .upgrade-banner .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.4);
        }

        /* Ad Overlay */
        .ad-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ad-container {
            width: 100%;
            max-width: 900px;
            padding: 20px;
        }

        .ad-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .ad-label {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
            padding: 5px 12px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .ad-countdown {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        .ad-player {
            aspect-ratio: 16/9;
            background: #111;
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ad-player iframe, .ad-player video {
            width: 100%;
            height: 100%;
            border: none;
        }

        .ad-skip-btn {
            margin-top: 15px;
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            float: right;
            transition: all 0.3s ease;
        }

        .ad-skip-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(34, 197, 94, 0.4);
        }

        /* Stream Error */
        .stream-error {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 15px;
            color: white;
        }

        .stream-error i {
            font-size: 3rem;
            color: #ffc107;
        }

        .stream-error p {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .stream-error button {
            background: rgba(139, 92, 246, 0.3);
            border: 1px solid rgba(139, 92, 246, 0.5);
            color: white;
            padding: 10px 25px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 5px;
        }

        .stream-error button:hover {
            background: rgba(139, 92, 246, 0.5);
        }

        /* Viewer count badge */
        .viewer-count {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .freetv-hero h1 {
                font-size: 2rem;
            }
            .channel-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">
                <img src="img/logo.png" alt="Purple Squirrel Media" class="logo-icon-svg">
                <span class="logo-text">Purple Squirrel<br><small>Media</small></span>
            </a>
            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="free-tv.html" class="active">Free TV</a>
                <a href="watch.html">Watch</a>
                <a href="plans.html">Plans</a>
                <a href="about.html">About</a>
            </div>
            <div class="nav-actions">
                <a href="login.html" class="btn btn-secondary">Sign In</a>
                <a href="plans.html" class="btn btn-primary">Get NFT Pass</a>
            </div>
        </div>
    </nav>

    <!-- Hero -->
    <section class="freetv-hero">
        <div class="freetv-hero-content">
            <h1>üì∫ Free Live TV</h1>
            <p style="color: rgba(255,255,255,0.8); font-size: 1.2rem;">
                Watch 50+ channels free - no sign up required. News, sports, movies, and more.
            </p>
            <div class="free-badge">
                <span>‚úì</span> Always Free ‚Ä¢ No Credit Card ‚Ä¢ No Account Needed
            </div>
        </div>
    </section>

    <!-- Pre-roll Ad Container -->
    <div class="ad-overlay" id="adOverlay" style="display: none;">
        <div class="ad-container">
            <div class="ad-header">
                <span class="ad-label">Advertisement</span>
                <span class="ad-countdown" id="adCountdown">Skip in 5s</span>
            </div>
            <div class="ad-player" id="adPlayer"></div>
            <button class="ad-skip-btn" id="adSkipBtn" style="display: none;" onclick="skipAd()">Skip Ad ‚Üí</button>
        </div>
    </div>

    <!-- Player Section (appears when channel selected) -->
    <section class="player-section" id="playerSection">
        <div class="main-player">
            <div class="player-wrapper">
                <iframe id="channelPlayer" allowfullscreen></iframe>
                <div class="stream-error" id="streamError" style="display: none;">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>Stream temporarily unavailable</p>
                    <button onclick="retryStream()">Retry</button>
                    <button onclick="nextChannel()">Try Next Channel</button>
                </div>
            </div>
            <div class="player-controls">
                <div class="current-channel">
                    <span class="live-indicator"><span class="live-dot"></span> LIVE</span>
                    <h2 id="currentChannelName">Channel Name</h2>
                </div>
                <div class="channel-nav">
                    <button onclick="prevChannel()">‚Üê Previous</button>
                    <button onclick="nextChannel()">Next ‚Üí</button>
                    <button onclick="closePlayer()">‚úï Close</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Channel Guide -->
    <section class="channel-guide">
        <div class="guide-header">
            <div>
                <h2>Live Channels</h2>
                <p style="color: rgba(255,255,255,0.6);">50+ channels streaming 24/7</p>
            </div>
            <div class="category-pills">
                <button class="category-pill active" data-category="all">All</button>
                <button class="category-pill" data-category="news">News</button>
                <button class="category-pill" data-category="entertainment">Entertainment</button>
                <button class="category-pill" data-category="sports">Sports</button>
                <button class="category-pill" data-category="movies">Movies</button>
                <button class="category-pill" data-category="music">Music</button>
                <button class="category-pill" data-category="kids">Kids</button>
            </div>
        </div>

        <div class="channel-grid" id="channelGrid">
            <!-- Channels loaded dynamically -->
        </div>
    </section>

    <!-- Upgrade Banner -->
    <section class="channel-guide">
        <div class="upgrade-banner">
            <h3>üöÄ Want Premium Content?</h3>
            <p>Get an NFT pass for 4K streaming, exclusive content, downloads, and ad-free viewing.</p>
            <a href="plans.html" class="btn">View NFT Plans</a>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <div class="logo" style="margin-bottom: 1rem;">
                    <img src="img/logo.png" alt="Purple Squirrel Media" class="logo-icon-svg">
                    <span class="logo-text">Purple Squirrel<br><small>Media</small></span>
                </div>
                <p>Free TV for everyone, premium content for NFT holders</p>
            </div>
            <div class="footer-section">
                <h4>Platform</h4>
                <a href="index.html">Home</a>
                <a href="free-tv.html">Free TV</a>
                <a href="watch.html">Premium</a>
                <a href="plans.html">Plans</a>
            </div>
            <div class="footer-section">
                <h4>Company</h4>
                <a href="about.html">About</a>
                <a href="contact.html">Contact</a>
            </div>
            <div class="footer-section">
                <h4>Legal</h4>
                <a href="terms.html">Terms of Service</a>
                <a href="privacy.html">Privacy Policy</a>
                <a href="dmca.html">DMCA</a>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 Purple Squirrel Media. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // API Configuration
        const API_BASE = 'http://163.192.105.31:8080/api/v1';

        // Ad Configuration
        const AD_CONFIG = {
            enabled: true,
            skipAfter: 5, // seconds
            showEveryNChannels: 3, // Show ad every N channel changes
            vastTag: null, // VAST tag URL (null = use demo ads)
            demoAds: [
                { type: 'image', src: 'https://images.unsplash.com/photo-1611162617474-5b21e879e113?w=800', duration: 5, link: 'plans.html', text: 'Upgrade to Premium - No Ads!' },
                { type: 'image', src: 'https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=800', duration: 5, link: 'advertise.html', text: 'Advertise on PSM - Reach Millions!' }
            ]
        };

        // Analytics & State
        let channelChangeCount = 0;
        let watchStartTime = null;
        let currentAdTimer = null;
        let adSkipCountdown = AD_CONFIG.skipAfter;

        // Free TV Channel Data
        const FREE_CHANNELS = [
            // News
            { id: 1, name: 'ABC News Live', category: 'news', genre: 'News', logo: 'üì∞', stream: 'https://www.youtube.com/embed/w_Ma8oQLmSM?autoplay=1', preview: 'https://images.unsplash.com/photo-1495020689067-958852a7765e?w=400' },
            { id: 2, name: 'CBS News', category: 'news', genre: '24/7 News', logo: 'üì∫', stream: 'https://www.youtube.com/embed/nCAH2Sgj5V0?autoplay=1', preview: 'https://images.unsplash.com/photo-1586339949916-3e9457bef6d3?w=400' },
            { id: 3, name: 'NBC News NOW', category: 'news', genre: 'Breaking News', logo: 'üóûÔ∏è', stream: 'https://www.youtube.com/embed/IW41ej5EZfY?autoplay=1', preview: 'https://images.unsplash.com/photo-1504711434969-e33886168f5c?w=400' },
            { id: 4, name: 'Al Jazeera', category: 'news', genre: 'World News', logo: 'üåç', stream: 'https://www.youtube.com/embed/gCNeDWCI0vo?autoplay=1', preview: 'https://images.unsplash.com/photo-1557992260-ec58e38d363c?w=400' },
            { id: 5, name: 'DW News', category: 'news', genre: 'International', logo: 'üá©üá™', stream: 'https://www.youtube.com/embed/-Q76H7SKPzQ?autoplay=1', preview: 'https://images.unsplash.com/photo-1478147427282-58a87a120781?w=400' },
            { id: 6, name: 'France 24', category: 'news', genre: 'Global News', logo: 'üá´üá∑', stream: 'https://www.youtube.com/embed/h3MuIUNCCzI?autoplay=1', preview: 'https://images.unsplash.com/photo-1529107386315-e1a2ed48a620?w=400' },

            // Entertainment
            { id: 10, name: 'Pluto TV Comedy', category: 'entertainment', genre: 'Comedy', logo: 'üòÇ', stream: 'https://www.youtube.com/embed/live_stream?channel=UCvjgEDvShRsAazREmoLnYaA&autoplay=1', preview: 'https://images.unsplash.com/photo-1586899028174-e7098604235b?w=400' },
            { id: 11, name: 'Reality TV', category: 'entertainment', genre: 'Reality Shows', logo: 'üé≠', stream: 'https://www.youtube.com/embed/live_stream?channel=UCxP7B1E3cg0H6q1qANaU6HA&autoplay=1', preview: 'https://images.unsplash.com/photo-1574375927938-d5a98e8ffe85?w=400' },
            { id: 12, name: 'Classic TV', category: 'entertainment', genre: 'Retro Shows', logo: 'üì∫', stream: 'https://www.youtube.com/embed/live_stream?channel=UC8-Th83bH_thdKZDJCrn88g&autoplay=1', preview: 'https://images.unsplash.com/photo-1593359677879-a4bb92f829d1?w=400' },

            // Sports
            { id: 20, name: 'ESPN News', category: 'sports', genre: 'Sports News', logo: '‚öΩ', stream: 'https://www.youtube.com/embed/live_stream?channel=UCiWLfSweyRNmLpgEHekhoAg&autoplay=1', preview: 'https://images.unsplash.com/photo-1461896836934- voices?w=400' },
            { id: 21, name: 'Stadium', category: 'sports', genre: 'Live Sports', logo: 'üèüÔ∏è', stream: 'https://www.youtube.com/embed/live_stream?channel=UCLyL0J6vpHxE-G2iA7KxXww&autoplay=1', preview: 'https://images.unsplash.com/photo-1540747913346-19e32dc3e97e?w=400' },
            { id: 22, name: 'beIN Sports', category: 'sports', genre: 'Football', logo: '‚öΩ', stream: 'https://www.youtube.com/embed/live_stream?channel=UCl4HVaFu9X3-ACvvY-lUF2Q&autoplay=1', preview: 'https://images.unsplash.com/photo-1522778119026-d647f0596c20?w=400' },

            // Movies
            { id: 30, name: 'Free Movies', category: 'movies', genre: 'Feature Films', logo: 'üé¨', stream: 'https://www.youtube.com/embed/live_stream?channel=UCwILLMsFwAOsuJCCShZ0xQQ&autoplay=1', preview: 'https://images.unsplash.com/photo-1536440136628-849c177e76a1?w=400' },
            { id: 31, name: 'Action Movies', category: 'movies', genre: 'Action', logo: 'üí•', stream: 'https://www.youtube.com/embed/live_stream?channel=UCmWoNs5zxiLQnfKZKGp8OVQ&autoplay=1', preview: 'https://images.unsplash.com/photo-1440404653325-ab127d49abc1?w=400' },
            { id: 32, name: 'Horror Channel', category: 'movies', genre: 'Horror', logo: 'üëª', stream: 'https://www.youtube.com/embed/live_stream?channel=UCKO-cHAA7bMoNQOQnxk0L8A&autoplay=1', preview: 'https://images.unsplash.com/photo-1509248961895-b886fea86ac5?w=400' },
            { id: 33, name: 'Sci-Fi Channel', category: 'movies', genre: 'Science Fiction', logo: 'üöÄ', stream: 'https://www.youtube.com/embed/live_stream?channel=UCQof25ozAHfLY-b4Vz-ASTA&autoplay=1', preview: 'https://images.unsplash.com/photo-1446776811953-b23d57bd21aa?w=400' },

            // Music
            { id: 40, name: 'MTV Classic', category: 'music', genre: 'Music Videos', logo: 'üéµ', stream: 'https://www.youtube.com/embed/live_stream?channel=UC-9-kyTW8ZkZNDHQJ6FgpwQ&autoplay=1', preview: 'https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=400' },
            { id: 41, name: 'Lo-Fi Radio', category: 'music', genre: 'Chill Beats', logo: 'üéß', stream: 'https://www.youtube.com/embed/jfKfPfyJRdk?autoplay=1', preview: 'https://images.unsplash.com/photo-1514525253161-7a46d19cd819?w=400' },
            { id: 42, name: 'Jazz FM', category: 'music', genre: 'Jazz', logo: 'üé∑', stream: 'https://www.youtube.com/embed/live_stream?channel=UCJIOFQLGwB3GH9K9waxwynQ&autoplay=1', preview: 'https://images.unsplash.com/photo-1415201364774-f6f0bb35f28f?w=400' },
            { id: 43, name: 'Electronic', category: 'music', genre: 'EDM', logo: 'üéπ', stream: 'https://www.youtube.com/embed/live_stream?channel=UCp6vaU3P0XHfbcEVOXb8YlA&autoplay=1', preview: 'https://images.unsplash.com/photo-1470225620780-dba8ba36b745?w=400' },

            // Kids
            { id: 50, name: 'Cartoon Network', category: 'kids', genre: 'Cartoons', logo: 'üé™', stream: 'https://www.youtube.com/embed/live_stream?channel=UCDv5brsgfcIBl1CAiXSwHHQ&autoplay=1', preview: 'https://images.unsplash.com/photo-1594736797933-d0501ba2fe65?w=400' },
            { id: 51, name: 'Kids Movies', category: 'kids', genre: 'Family Films', logo: 'üë∂', stream: 'https://www.youtube.com/embed/live_stream?channel=UCJ2JCb3j48rlqiCl5zYm2lg&autoplay=1', preview: 'https://images.unsplash.com/photo-1485546246426-74dc88dec4d9?w=400' },
            { id: 52, name: 'Educational', category: 'kids', genre: 'Learning', logo: 'üìö', stream: 'https://www.youtube.com/embed/live_stream?channel=UC_x5XG1OV2P6uZZ5FSM9Ttw&autoplay=1', preview: 'https://images.unsplash.com/photo-1503676260728-1c00da094a0b?w=400' },
        ];

        let currentChannelIndex = 0;

        // Initialize
        function init() {
            renderChannels('all');
            setupCategoryFilters();
        }

        // Generate random viewer count (simulated)
        function getViewerCount(channelId) {
            // Seed random with channel ID for consistency
            const base = (channelId * 7919) % 10000;
            const variance = Math.floor(Math.random() * 500);
            return base + variance;
        }

        // Format viewer count
        function formatViewers(count) {
            if (count >= 1000) {
                return (count / 1000).toFixed(1) + 'K';
            }
            return count.toString();
        }

        // Render channel cards
        function renderChannels(category) {
            const grid = document.getElementById('channelGrid');
            const filtered = category === 'all'
                ? FREE_CHANNELS
                : FREE_CHANNELS.filter(ch => ch.category === category);

            grid.innerHTML = filtered.map((channel, index) => `
                <div class="channel-card" onclick="playChannel(${channel.id})" data-category="${channel.category}">
                    <div class="channel-preview">
                        <img src="${channel.preview}" alt="${channel.name}" onerror="this.src='https://images.unsplash.com/photo-1593784991095-a205069470b6?w=400'">
                        <div class="now-playing">
                            <span class="live-indicator"><span class="live-dot"></span> LIVE</span>
                            <div class="title">${channel.name}</div>
                        </div>
                        <div class="channel-logo">${channel.logo}</div>
                    </div>
                    <div class="channel-info">
                        <h3>
                            ${channel.name}
                            <span class="live-indicator" style="font-size: 0.7rem;"><span class="live-dot"></span> LIVE</span>
                        </h3>
                        <p class="genre">${channel.genre}</p>
                        <span class="viewer-count"><i class="fas fa-eye"></i> ${formatViewers(getViewerCount(channel.id))} watching</span>
                    </div>
                </div>
            `).join('');
        }

        // Setup category filters
        function setupCategoryFilters() {
            document.querySelectorAll('.category-pill').forEach(pill => {
                pill.addEventListener('click', (e) => {
                    document.querySelectorAll('.category-pill').forEach(p => p.classList.remove('active'));
                    e.target.classList.add('active');
                    renderChannels(e.target.dataset.category);
                });
            });
        }

        // Play channel with ad integration
        function playChannel(channelId) {
            const channel = FREE_CHANNELS.find(ch => ch.id === channelId);
            if (!channel) return;

            // Track previous watch time
            if (watchStartTime) {
                const watchDuration = Math.floor((Date.now() - watchStartTime) / 1000);
                trackAnalytics('channel_watch', {
                    channel_id: FREE_CHANNELS[currentChannelIndex]?.id,
                    duration: watchDuration
                });
            }

            currentChannelIndex = FREE_CHANNELS.findIndex(ch => ch.id === channelId);
            channelChangeCount++;

            // Show pre-roll ad every N channel changes
            if (AD_CONFIG.enabled && channelChangeCount % AD_CONFIG.showEveryNChannels === 0) {
                showPrerollAd(() => {
                    startChannel(channel);
                });
            } else {
                startChannel(channel);
            }
        }

        // Start playing a channel (after ad or directly)
        function startChannel(channel) {
            const player = document.getElementById('channelPlayer');
            const section = document.getElementById('playerSection');
            const nameEl = document.getElementById('currentChannelName');
            const errorEl = document.getElementById('streamError');

            // Hide error state
            errorEl.style.display = 'none';

            player.src = channel.stream;
            nameEl.textContent = channel.name;
            section.classList.add('active');

            // Track watch start
            watchStartTime = Date.now();
            trackAnalytics('channel_play', {
                channel_id: channel.id,
                channel_name: channel.name,
                category: channel.category
            });

            // Scroll to player
            section.scrollIntoView({ behavior: 'smooth' });
        }

        // Pre-roll Ad System
        function showPrerollAd(onComplete) {
            const overlay = document.getElementById('adOverlay');
            const adPlayer = document.getElementById('adPlayer');
            const countdown = document.getElementById('adCountdown');
            const skipBtn = document.getElementById('adSkipBtn');

            // Get random demo ad
            const ad = AD_CONFIG.demoAds[Math.floor(Math.random() * AD_CONFIG.demoAds.length)];

            // Show ad overlay
            overlay.style.display = 'flex';
            skipBtn.style.display = 'none';
            adSkipCountdown = AD_CONFIG.skipAfter;

            // Render ad content
            adPlayer.innerHTML = `
                <a href="${ad.link}" style="display: block; width: 100%; height: 100%; position: relative;">
                    <img src="${ad.src}" style="width: 100%; height: 100%; object-fit: cover;" alt="Advertisement">
                    <div style="position: absolute; bottom: 20px; left: 20px; right: 20px; background: rgba(0,0,0,0.8); padding: 15px; border-radius: 8px;">
                        <p style="margin: 0; font-size: 1.2rem; font-weight: 600;">${ad.text}</p>
                    </div>
                </a>
            `;

            // Track ad impression
            trackAnalytics('ad_impression', { ad_type: 'preroll', ad_link: ad.link });

            // Countdown timer
            currentAdTimer = setInterval(() => {
                adSkipCountdown--;
                if (adSkipCountdown > 0) {
                    countdown.textContent = `Skip in ${adSkipCountdown}s`;
                } else {
                    countdown.textContent = 'You can skip now';
                    skipBtn.style.display = 'block';
                    clearInterval(currentAdTimer);
                }
            }, 1000);

            // Store callback
            window.adCompleteCallback = onComplete;
        }

        // Skip ad
        function skipAd() {
            const overlay = document.getElementById('adOverlay');
            const adPlayer = document.getElementById('adPlayer');

            clearInterval(currentAdTimer);
            overlay.style.display = 'none';
            adPlayer.innerHTML = '';

            trackAnalytics('ad_skip', { skip_time: AD_CONFIG.skipAfter - adSkipCountdown });

            if (window.adCompleteCallback) {
                window.adCompleteCallback();
                window.adCompleteCallback = null;
            }
        }

        // Retry stream
        function retryStream() {
            const channel = FREE_CHANNELS[currentChannelIndex];
            if (channel) {
                document.getElementById('streamError').style.display = 'none';
                document.getElementById('channelPlayer').src = channel.stream;
            }
        }

        // Analytics tracking
        function trackAnalytics(event, data = {}) {
            const payload = {
                event,
                timestamp: new Date().toISOString(),
                session_id: getSessionId(),
                ...data
            };

            // Log to console for debugging
            console.log('üìä Analytics:', event, data);

            // Send to backend (fire and forget)
            fetch(`${API_BASE}/analytics/freetv`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            }).catch(() => { /* Silently fail - analytics shouldn't break UX */ });
        }

        // Get or create session ID
        function getSessionId() {
            let sid = sessionStorage.getItem('psm_session_id');
            if (!sid) {
                sid = 'ftv_' + Math.random().toString(36).substring(2, 15);
                sessionStorage.setItem('psm_session_id', sid);
            }
            return sid;
        }

        // Navigation
        function prevChannel() {
            currentChannelIndex = (currentChannelIndex - 1 + FREE_CHANNELS.length) % FREE_CHANNELS.length;
            playChannel(FREE_CHANNELS[currentChannelIndex].id);
        }

        function nextChannel() {
            currentChannelIndex = (currentChannelIndex + 1) % FREE_CHANNELS.length;
            playChannel(FREE_CHANNELS[currentChannelIndex].id);
        }

        function closePlayer() {
            const player = document.getElementById('channelPlayer');
            const section = document.getElementById('playerSection');
            player.src = '';
            section.classList.remove('active');
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closePlayer();
            if (e.key === 'ArrowLeft') prevChannel();
            if (e.key === 'ArrowRight') nextChannel();
        });

        // Track page unload
        window.addEventListener('beforeunload', () => {
            if (watchStartTime) {
                const watchDuration = Math.floor((Date.now() - watchStartTime) / 1000);
                trackAnalytics('session_end', {
                    total_channels_watched: channelChangeCount,
                    last_watch_duration: watchDuration
                });
            }
        });

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            init();
            trackAnalytics('page_view', { page: 'free-tv' });
        });
    </script>
</body>
</html>
